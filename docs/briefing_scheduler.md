# 📅 AEGIS Briefing Scheduler 가이드

AEGIS 브리핑 스케줄러는 사용자의 생활 패턴에 맞춰 알림(TTS, 동작 등)을 허용하거나 차단하고, 정해진 시간에 자동으로 브리핑을 수행하는 중앙 관리 모듈입니다.

## 1. 주요 개념

### 🛡️ Gatekeeper (수문장)
각 위젯(주식, 이메일 등)의 알림이 나가는 **'창구'**를 관리합니다.
- **Allow (허용):** 알림이 가능한 시간대를 정의합니다.
- **Deny (차단):** 알림을 절대 금지하는 시간대를 정의합니다.
- **원칙:** **Deny Wins (차단 우선)**. 허용 조건에 맞더라도 차단 조건에 하나라도 해당하면 알림은 나가지 않습니다.

### ⏰ Routines (루틴)
사용자가 요청하지 않아도 시스템이 **'정해진 시간'**에 스스로 행동하게 합니다.
- **가능한 액션(Actions):**
  - `tactical_briefing`: 전체 데이터 기반 AI 요약 보고 실행.
  - `widget_briefing`: 특정 위젯만 요약 (target 필드 필요, 예: `news`, `stock`, `calendar`).
  - `speak`: 특정 텍스트를 음성으로 출력 (text 필드 필요).
  - `reload`: 대시보드 페이지 새로고침 (일일 세션 갱신 등).

---

## 2. 설정 방법 (`config/scheduler.json`)

### 요일 매핑 (Days)
요일은 0부터 6까지의 숫자로 표현합니다.
- `0`: 일요일 (Sun)
- `1`: 월요일 (Mon)
- `2`: 화요일 (Tue)
- `3`: 수요일 (Wed)
- `4`: 목요일 (Thu)
- `5`: 금요일 (Fri)
- `6`: 토요일 (Sat)
- 예: `[1,2,3,4,5]` -> 평일만 허용

### 시간 포맷 (Time)
- **Gatekeeper:** `HHMM` 형식의 문자열 (예: `"0900"`, `"1530"`, `"2300"`)
- **Routines:** `HH:MM` 형식의 문자열 (예: `"09:00"`, `"21:30"`)

---

## 3. 실전 예시

### 예시 1: 주식 시장 시간 알림
평일 주식 시장 시간(09:00~15:30)에만 알림을 허용하고 주말은 차단합니다.
```json
"stock": {
  "allow": { "days": [1,2,3,4,5], "start": "0900", "end": "1530" },
  "deny": { "days": [0,6] },
  "enabled": true
}
```

### 예시 2: 자정 넘는 심야 시간 차단
밤 11시부터 다음 날 아침 7시까지 모든 알림을 차단합니다. (자정 전후 범위 지원)
```json
"night_mode": {
  "deny": { "start": "2300", "end": "0700" },
  "enabled": true
}
```

### 예시 3: 평일 아침 정기 브리핑 루틴
매일 아침 9시에 아바타가 자동으로 전술 브리핑을 시작합니다.
```json
{
  "id": "morning_briefing",
  "name": "평일 아침 정기 뉴스 브리핑",
  "time": "09:00",
  "days": [1, 2, 3, 4, 5],
  "action": "tactical_briefing",
  "enabled": true
}
```

### 예시 4: 특정 위젯 브리핑 (뉴스만 요약)
매일 오후 2시에 뉴스 위젯만 집중 브리핑합니다.
```json
{
  "id": "afternoon_news",
  "action": "widget_briefing",
  "target": "news",
  "time": "14:00",
  "days": [1, 2, 3, 4, 5],
  "enabled": true
}
```

### 예시 5: 커스텀 음성 메시지
저녁 9시에 따뜻한 인사를 음성으로 출력합니다.
```json
{
  "id": "night_greeting",
  "action": "speak",
  "text": "오늘 하루도 수고 많으셨습니다. 편안한 밤 되세요.",
  "time": "21:00",
  "days": [0, 1, 2, 3, 4, 5, 6],
  "enabled": true
}
```

### 예시 6: 자동 시스템 갱신
매일 새벽 4시에 페이지를 새로고침하여 세션을 갱신합니다.
```json
{
  "id": "auto_init",
  "action": "reload",
  "time": "04:00",
  "days": [0, 1, 2, 3, 4, 5, 6],
  "enabled": true
}
```

---

## 4. 기술적 세부 사항
- 스케줄러는 프론트엔드(`briefing_scheduler.js`)에서 동작하며, `ReactionEngine`이 리액션을 수행하기 직전에 권한을 체크합니다.
- 루틴은 1분 단위로 체크되며, 동일한 루틴이 하루에 여러 번 실행되지 않도록 내부적으로 처리됩니다.
